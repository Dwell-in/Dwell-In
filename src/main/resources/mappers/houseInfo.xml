<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ssafy.home.house.model.dao.HouseinfoDAO">
	<resultMap type="HouseinfoDTO" id="HouseinfoMap">
		<id column="apt_seq" property="aptSeq"/>
		<result column="apt_nm" property="aptNm"/>
		<result column="build_year" property="buildYear"/>
		<result column="latitude" property="lat"/>
		<result column="longitude" property="lon"/>
		<result column="view_count" property="viewCount"/>
	</resultMap>
	
	<resultMap type="HouseinfoDTO" id="InfoDealMap" extends="HouseinfoMap">
		<collection
			property="listDeal"
			column="apt_seq = apt_seq"
			ofType="HouserdealDTO">
			<result column="apt_seq" property="aptSeq"/>
			<result column="deal_year" property="dealYear"/>
			<result column="deal_month" property="dealMonth"/>
			<result column="deal_day" property="dealDay"/>
			<result column="exclu_use_ar" property="exclu"/>
			<result column="deal_amount" property="amount"/>
		</collection>
	</resultMap>
	
	
	<select id="selectInfoList" resultMap="InfoDealMap">
		select apt_seq, apt_nm, build_year, latitude, longitude, view_count, deal_year, deal_month, deal_day, exclu_use_ar, deal_amount
		from houseinfos i
		left join housedeals using(apt_seq)
		where sgg_cd = #{sggCd} and umd_cd = #{umdCd}
		ORDER BY deal_year ASC, deal_month ASC, deal_day;
	</select>
	
	<update id="updateViewCount">
		update houseinfos 
		set view_count = view_count+1
		where apt_seq = #{aptSeq};
	</update>
	
	<select id="selectViewCount">
		select view_count from houseinfos
		where apt_seq = #{aptSeq}; 
	</select>
</mapper>